<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday, Dylan!</title>
    <!-- Emoji Favicon for the page -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéÅ</text></svg>">
    <style>
        /* --- General Setup & Resets --- */
        :root {
            --background-color: #f0f4f8;
            --text-color: #333;
            --beam-gradient: linear-gradient(to top, rgba(255, 223, 0, 0.8) 0%, rgba(255, 255, 255, 0) 100%);
            --animation-duration-long: 5s;
            --transition-speed: 0.5s; /* Controls fade speed */
            /* Configurable beam properties set by JavaScript */
            --beam-length: 150px;
            --beam-width: 80px;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100dvh;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        /* --- Main Container & Centering --- */
        .container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            height: 100%;
            padding: 1rem;
            box-sizing: border-box;
            /* Added transition for the global fade effect */
            transition: opacity var(--transition-speed) ease-in-out;
        }

        /* --- Content Styling --- */
        h1 {
            font-size: clamp(2rem, 8vw, 3.5rem);
            background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb, #1dd1a1);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .present-container {
            position: relative;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 1rem;
        }

        .present-emoji {
            font-size: clamp(6rem, 25vw, 10rem);
            z-index: 1;
            transition: transform 0.3s ease-out;
        }

        .present-text {
            margin-top: 0.5rem;
            font-size: 1rem;
            color: #666;
        }

        /* --- Final Message (Book Recommendation) --- */
        .final-message {
            display: none; /* Initially hidden, display controlled by JS */
            flex-direction: column;
            align-items: center;
            width: 90%;
            max-width: 600px;
            box-sizing: border-box;
        }

        .final-message .book-emoji { font-size: 4rem; margin-bottom: 1rem; }
        .final-message p { margin: 0.25rem 0; line-height: 1.6; }
        .book-description { overflow-wrap: break-word; word-wrap: break-word; }
        .book-title { font-weight: bold; font-size: 1.1rem; }
        .book-subtitle { font-style: italic; color: #555; margin-top: 0.1rem; }
        .recommender { margin-top: 1.5rem; font-size: 0.9rem; color: #555; }

        /* --- Animations --- */
        .light-beam {
            position: absolute;
            bottom: 50%;
            left: 50%;
            width: var(--beam-width);
            height: var(--beam-length);
            background: var(--beam-gradient);
            transform-origin: bottom;
            opacity: 0;
            z-index: 0;
            clip-path: polygon(40% 100%, 60% 100%, 100% 0, 0 0);
        }
        
        .light-beam.active {
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }

        .confetti {
            position: absolute;
            top: -50px;
            font-size: 1.5rem;
            animation: fall var(--animation-duration-long) linear forwards;
            user-select: none;
        }

        /* --- Keyframes --- */
        @keyframes fall {
            to {
                transform: translateY(110dvh) rotate(720deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>

    <div class="container" id="main-container">
        <h1 id="heading">Happy Birthday, Dylan!</h1>
        <div class="present-container" id="present-container">
            <div class="present-emoji" id="present-emoji">üéÅ</div>
            <p class="present-text" id="present-text">Click to open your present</p>
        </div>
        <div class="final-message" id="final-message"></div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const config = {
            confettiEmojis: ['üéâ', 'üéÇ', 'ü•≥', 'üéà'],
            // Responsive confetti count based on screen width
            confettiCount: {
                small: 50,  // for mobile (< 768px)
                medium: 100, // for tablet (>= 768px)
                large: 150  // for desktop (>= 1024px)
            },
            confettiSpawnDuration: 2500, // Duration for SPAWNING confetti
            numLightBeams: 7,
            beamAnimation: {
                totalDuration: 2000,
                length: 360,
                width: 90
            },
            rockingAnimation: {
                maxDegrees: 10,
                maxSpeed: 0.25,
                acceleration: 0.001
            },
            book: {
                title: "Agentic Artificial Intelligence",
                subtitle: "Harnessing AI Agents to Reinvent Business, Work and Life",
                author: "Pascal Bornet, et al.",
                description: "A research-backed non-technical roadmap for our adoption of AI agents. It focuses on how to build agents that take action, with case studies showing 25% cost reduction and 40% higher customer satisfaction.",
                recommender: "Keming He"
            }
        };

        // --- DOM ELEMENT REFERENCES ---
        const mainContainer = document.getElementById('main-container');
        const presentContainer = document.getElementById('present-container');
        const presentEmoji = document.getElementById('present-emoji');
        const finalMessageContainer = document.getElementById('final-message');

        // --- ANIMATION STATE ---
        let animationFrameId = null;
        let beams = [];
        let beamTimeouts = [];

        // --- MODULAR FUNCTIONS ---

        /**
         * Shuffles an array in place.
         * @param {Array} array The array to shuffle.
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        /**
         * Sets CSS variables from the config object for dynamic styling.
         */
        function applyDynamicStyles() {
            const root = document.documentElement;
            root.style.setProperty('--beam-length', `${config.beamAnimation.length}px`);
            root.style.setProperty('--beam-width', `${config.beamAnimation.width}px`);
        }
        
        /**
         * Returns the appropriate number of confetti based on screen width.
         * @returns {number} The number of confetti to spawn.
         */
        function getConfettiCount() {
            const width = window.innerWidth;
            if (width < 768) return config.confettiCount.small;
            if (width < 1024) return config.confettiCount.medium;
            return config.confettiCount.large;
        }

        /**
         * Generates and appends light beams in a 360-degree circle.
         */
        function setupLightBeams() {
            const angleStep = 360 / config.numLightBeams;
            for (let i = 0; i < config.numLightBeams; i++) {
                const beam = document.createElement('div');
                beam.className = 'light-beam';
                const rotation = i * angleStep;
                beam.style.transform = `translateX(-50%) rotate(${rotation}deg)`;
                presentContainer.prepend(beam);
                beams.push(beam);
            }
        }

        /**
         * Starts the dynamic rocking animation which gradually increases in intensity.
         */
        function startRockingAnimation() {
            let time = 0;
            let currentSpeed = 0;
            const { maxSpeed, acceleration, maxDegrees } = config.rockingAnimation;
            
            function animate() {
                if (currentSpeed < maxSpeed) currentSpeed += acceleration;
                time += currentSpeed;
                const rotation = maxDegrees * Math.sin(time);
                presentEmoji.style.transform = `rotate(${rotation}deg)`;
                animationFrameId = requestAnimationFrame(animate);
            }
            
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            animationFrameId = requestAnimationFrame(animate);
        }

        /**
         * Stops the rocking animation and resets the present's position.
         */
        function stopRockingAnimation() {
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
            presentEmoji.style.transform = 'rotate(0deg)';
        }

        /**
         * Populates the final message container with the book details.
         */
        function populateFinalMessage() {
            const { book } = config;
            finalMessageContainer.innerHTML = `
                <div class="book-emoji">üìï</div>
                <p class="book-title">${book.title}</p>
                <p class="book-subtitle">${book.subtitle}</p>
                <p class="book-author">by ${book.author}</p>
                <p class="book-description">${book.description}</p>
                <p class="recommender">- recommended by ${book.recommender}</p>
            `;
        }

        /**
         * Creates a sustained shower of confetti over a period of time.
         */
        function triggerConfettiShower() {
            const numConfetti = getConfettiCount();
            const { confettiSpawnDuration, confettiEmojis } = config;
            const spawnInterval = confettiSpawnDuration / numConfetti;
            let spawnedCount = 0;

            const intervalId = setInterval(() => {
                if (spawnedCount >= numConfetti) {
                    clearInterval(intervalId);
                    return;
                }

                const confetti = document.createElement('div');
                const fallAnimationDuration = 5000; 
                const randomAnimationDelay = Math.random() * 2000; 

                confetti.className = 'confetti';
                confetti.innerText = confettiEmojis[spawnedCount % confettiEmojis.length];
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.animationDelay = `${randomAnimationDelay / 1000}s`;
                confetti.style.fontSize = `${1 + Math.random() * 1.5}rem`;
                
                document.body.appendChild(confetti);

                const timeToRemove = fallAnimationDuration + randomAnimationDelay;
                setTimeout(() => confetti.remove(), timeToRemove);

                spawnedCount++;
            }, spawnInterval);
        }

        // --- EVENT LISTENERS ---
        function setupEventListeners() {
            presentContainer.addEventListener('mouseenter', () => {
                shuffleArray(beams);
                const delayIncrement = config.beamAnimation.totalDuration / beams.length;
                let delay = 0;
                beams.forEach(beam => {
                    const timeoutId = setTimeout(() => beam.classList.add('active'), delay);
                    beamTimeouts.push(timeoutId);
                    delay += delayIncrement;
                });
                startRockingAnimation();
            });

            presentContainer.addEventListener('mouseleave', () => {
                beamTimeouts.forEach(clearTimeout);
                beamTimeouts = [];
                beams.forEach(beam => beam.classList.remove('active'));
                stopRockingAnimation();
            });

            presentContainer.addEventListener('click', () => {
                // 1. Fade out the entire container
                mainContainer.style.opacity = '0';
                triggerConfettiShower();

                // 2. After the fade-out, swap the content while it's invisible
                setTimeout(() => {
                    presentContainer.style.display = 'none';
                    finalMessageContainer.style.display = 'flex';

                    // 3. Fade the container back in with the new content
                    mainContainer.style.opacity = '1';
                }, 500); // This duration must match --transition-speed in CSS

            }, { once: true });
        }

        // --- INITIALIZATION ---
        function init() {
            applyDynamicStyles();
            populateFinalMessage();
            setupLightBeams();
            setupEventListeners();
        }

        init();
    </script>
</body>
</html>
